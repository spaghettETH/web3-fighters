{
  "rules": {
    "_auth": {
      ".read": true,
      ".write": true
    },
    
    "debates": {
      ".read": true,
      ".write": "root.child('_auth').child('passkey').val() === 'bfethcc8master' && root.child('_auth').child('timestamp').exists() && root.child('_auth').child('timestamp').val() > (now - 60000)",
      
      "$debateId": {
        ".validate": "newData.hasChildren(['id', 'title', 'fighter1', 'fighter2', 'status', 'totalVotes'])",
        
        "fighter1": {
          "votes": {
            ".write": "root.child('_auth').child('passkey').exists() && (root.child('_auth').child('passkey').val() === 'BFethcc8' || root.child('_auth').child('passkey').val() === 'bfethcc8master') && root.child('_auth').child('timestamp').exists() && root.child('_auth').child('timestamp').val() > (now - 60000)",
            ".validate": "newData.isNumber() && newData.val() >= data.val()"
          }
        },
        "fighter2": {
          "votes": {
            ".write": "root.child('_auth').child('passkey').exists() && (root.child('_auth').child('passkey').val() === 'BFethcc8' || root.child('_auth').child('passkey').val() === 'bfethcc8master') && root.child('_auth').child('timestamp').exists() && root.child('_auth').child('timestamp').val() > (now - 60000)",
            ".validate": "newData.isNumber() && newData.val() >= data.val()"
          }
        },
        "totalVotes": {
          ".write": "root.child('_auth').child('passkey').exists() && (root.child('_auth').child('passkey').val() === 'BFethcc8' || root.child('_auth').child('passkey').val() === 'bfethcc8master') && root.child('_auth').child('timestamp').exists() && root.child('_auth').child('timestamp').val() > (now - 60000)",
          ".validate": "newData.isNumber() && newData.val() >= data.val()"
        }
      }
    },
    
    "votes": {
      ".read": true,
      ".write": "root.child('_auth').child('passkey').exists() && (root.child('_auth').child('passkey').val() === 'BFethcc8' || root.child('_auth').child('passkey').val() === 'bfethcc8master') && root.child('_auth').child('timestamp').exists() && root.child('_auth').child('timestamp').val() > (now - 60000)",
      
      "$deviceId": {
        "$debateId": {
          ".validate": "newData.hasChildren(['deviceId', 'debateId', 'fighterId', 'timestamp'])",
          
          "deviceId": {
            ".validate": "newData.isString() && newData.val() === $deviceId"
          },
          "debateId": {
            ".validate": "newData.isNumber()"
          },
          "fighterId": {
            ".validate": "newData.isNumber()"
          },
          "timestamp": {
            ".validate": "newData.isNumber()"
          }
        }
      }
    }
  }
} 